import telegram
from telegram.ext import Updater, CommandHandler
from googleapiclient.discovery import build
import time

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
TELEGRAM_BOT_TOKEN = "–í–ê–®_TE8044378203:AAFNVsZlYbiF5W0SX10uxr5W3ZT-WYKpebs–Å–ÅLEGRAM_BOT_TOKEN"
TELEGRAM_CHANNEL_ID = "@pmchat123"  # –∏–ª–∏ ID —á–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, -100123456789)
YOUTUBE_API_KEY = "AIzaSyDR_iQo0qOpZ6jIEnZQZfija-QXVAMEogc"
YOUTUBE_CHANNEL_ID = "nukes1908"  # –ù–∞–ø—Ä–∏–º–µ—Ä, UCxxxxxx

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è YouTube API
youtube = build('youtube', 'v3', developerKey=YOUTUBE_API_KEY)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–¥–µ–æ
def get_latest_video():
    request = youtube.search().list(
        channelId=YOUTUBE_CHANNEL_ID,
        part="id,snippet",
        order="date",
        maxResults=1
    )
    response = request.execute()
    video_id = response['items'][0]['id']['videoId']
    video_title = response['items'][0]['snippet']['title']
    video_url = f"https://youtu.be/{video_id}"
    return video_title, video_url

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
def send_to_telegram(message):
    bot = telegram.Bot(token=TELEGRAM_BOT_TOKEN)
    bot.send_message(chat_id=TELEGRAM_CHANNEL_ID, text=message)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ
def check_new_video(context):
    latest_video_title, latest_video_url = get_latest_video()
    message = f"üé• –ù–æ–≤–æ–µ –≤–∏–¥–µ–æ –Ω–∞ –∫–∞–Ω–∞–ª–µ!\n\n{latest_video_title}\n\n–°—Å—ã–ª–∫–∞: {latest_video_url}"
    send_to_telegram(message)

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
def main():
    updater = Updater(TELEGRAM_BOT_TOKEN, use_context=True)
    job_queue = updater.job_queue
    job_queue.run_repeating(check_new_video, interval=3600, first=0)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 3600 —Å–µ–∫ (1 —á–∞—Å)
    updater.start_polling()
    updater.idle()

if __name__ == "__main__":
    main()